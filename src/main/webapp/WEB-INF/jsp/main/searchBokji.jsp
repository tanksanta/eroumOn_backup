<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<header id="subject">
	<nav class="breadcrumb">
		<ul>
			<li class="home"><a href="${_mainPath}">홈</a></li>
			<li>이로움 서비스</li>
			<li>복지정보 서비스</li>
		</ul>
	</nav>
	<h2 class="subject">
		어르신 복지 서비스 <img src="/html/page/index/assets/images/ico-subject1.png" alt="파일이미지">
		<small>어르신복지가 궁금하세요? <a href="#" class="welfare-service-toggle">확인하기 <i class="icon-plus"></i></a></small>
	</h2>
</header>

<div id="content">
	<div class="welfare-service-desc">
		<div class="content">
			<img src="/html/page/index/assets/images/img-welfare-content1.jpg" alt="">
			<img src="/html/page/index/assets/images/img-welfare-content2.jpg" alt="">
			<img src="/html/page/index/assets/images/img-welfare-content3.jpg" alt="">
		</div>
		<button type="button" class="close">닫기</button>
	</div>


	<h3 class="careinfo-title">어르신 복지 <span class="text-indexKey1">추천 Hot 10</span></h3>
	<div class="recommended-hot">
		<div class="recommended-hot-box first">
			<span class="badge-eroum">이로움 01</span>
			<div class="flex flex-col gap-2 mt-7">
				<h4 class="text-3xl lg:text-5xl"><strong>어르신용품</strong> 구매비 지원</h4>
				<p class="text-lg lg:text-2xl leading-tight font-light">신체활동이 불편하신 어르신이라면,<br><strong class="font-medium">어르신용품을 신청하세요</strong></p>
			</div>
			<a href="#" class="btn btn-primary2 btn-arrow mt-8 md:mt-13 lg:mt-23 mr-auto"><strong>자세히보기</strong></a>
			<span class="bg-eroum-service"><img src="/html/page/index/assets/images/bg-eroum-service01.png" alt="어르신용품구매지원비 이미지"/></span>
		</div>
		<div class="recommended-hot-box second">
			<span class="badge-eroum">이로움 02</span>
			<div class="flex flex-col gap-1 mt-4">
				<h4 class="text-3xl leading-tight"><strong>요양시설 입소(시설급여)</strong> 이용비 지원</h4>
				<p class="text-lg">집에서 생활이 어려운 어르신이라면, <strong class="font-medium">요양 전문 시설 입소를 신청하세요.</strong></p>
			</div>
			<a href="#" class="btn btn-primary2 btn-arrow mt-8"><strong>자세히보기</strong></a>
			<span class="bg-eroum-service"><img src="/html/page/index/assets/images/bg-eroum-service02.png" alt="요양시설 입소(시설급여)이용비지원 이미지"/></span>
		</div>
		<div class="recommended-hot-border">
			<div class="subject-inner">
				<div class="subject-inner-text">
					<span class="badge-eroum">이로움 03</span>
					<h4><strong>가정방문(재가)</strong><br>이용비 지원</h4>
				</div>
				<div class="subject-inner-link">
					<a href="#" class="btn-detail">자세히보기</a>
					<i class="icon-eroum-service"><img src="/html/page/index/assets/images/icon-service-item03.svg" alt="재가"/></i>
				</div>
			</div>
		</div>
		<div class="recommended-hot-border">
			<div class="subject-inner">
				<div class="subject-inner-text">
					<span class="badge-eroum">이로움 04</span>
					<h4><strong>보청기</strong><br>구매비 지원</h4>
				</div>
				<div class="subject-inner-link">
					<a href="#" class="btn-detail">자세히보기</a>
					<i class="icon-eroum-service"><img src="/html/page/index/assets/images/icon-service-item04.svg" alt="보청기"/></i>
				</div>
			</div>
		</div>
		<div class="recommended-hot-border">
			<div class="subject-inner">
				<div class="subject-inner-text">
					<span class="badge-eroum">이로움 05</span>
					<h4><strong>임플란트</strong><br>이용 지원</h4>
				</div>
				<div class="subject-inner-link">
					<a href="#" class="btn-detail">자세히보기</a>
					<i class="icon-eroum-service"><img src="/html/page/index/assets/images/icon-service-item05.svg" alt="임플란트"/></i>
				</div>
			</div>
		</div>
		<div class="recommended-hot-border">
			<div class="subject-inner">
				<div class="subject-inner-text">
					<span class="badge-eroum">이로움 06</span>
					<h4><strong>틀니</strong><br>이용 지원</h4>
				</div>
				<div class="subject-inner-link">
					<a href="#" class="btn-detail">자세히보기</a>
					<i class="icon-eroum-service"><img src="/html/page/index/assets/images/icon-service-item06.svg" alt="틀니"/></i>
				</div>
			</div>
		</div>
		<div class="recommended-hot-border">
			<div class="subject-inner">
				<div class="subject-inner-text">
					<span class="badge-eroum">이로움 07</span>
					<h4><strong>인공관절</strong><br>수술비 지원</h4>
				</div>
				<div class="subject-inner-link">
					<a href="#" class="btn-detail">자세히보기</a>
					<i class="icon-eroum-service"><img src="/html/page/index/assets/images/icon-service-item07.svg" alt="인공관절"/></i>
				</div>
			</div>
		</div>
		<div class="recommended-hot-border">
			<div class="subject-inner">
				<div class="subject-inner-text">
					<span class="badge-eroum">이로움 08</span>
					<h4><strong>노인개안</strong><br>수술비 지원</h4>
				</div>
				<div class="subject-inner-link">
					<a href="#" class="btn-detail">자세히보기</a>
					<i class="icon-eroum-service"><img src="/html/page/index/assets/images/icon-service-item08.svg" alt="인공관절"/></i>
				</div>
			</div>
		</div>
		<div class="recommended-hot-border">
			<div class="subject-inner">
				<div class="subject-inner-text">
					<span class="badge-eroum">이로움 09</span>
					<h4><strong>치매 검사비</strong><br>지원</h4>
				</div>
				<div class="subject-inner-link">
					<a href="#" class="btn-detail">자세히보기</a>
					<i class="icon-eroum-service"><img src="/html/page/index/assets/images/icon-service-item09.svg" alt="치매 검사비"/></i>
				</div>
			</div>
		</div>
		<div class="recommended-hot-border">
			<div class="subject-inner">
				<div class="subject-inner-text">
					<span class="badge-eroum">이로움 10</span>
					<h4><strong>치매 치료비</strong><br>지원</h4>
				</div>
				<div class="subject-inner-link">
					<a href="#" class="btn-detail">자세히보기</a>
					<i class="icon-eroum-service"><img src="/html/page/index/assets/images/icon-service-item10.svg" alt="치매 치료비"/></i>
				</div>
			</div>
		</div>
	</div>
	
	<jsp:include page="searchBokji-modal.jsp" flush="true"/>

	<nav class="welfare-service-category">
		<div class="careinfo-title-wrap">
			<h3 class="careinfo-title">통합복지 <span class="font-normal">목록</span></h3>
			<p class="careinfo-count self-end"><strong class="totalCnt"></strong>건</p>
		</div>
		<ul  id="category_view" class="option-nav">
			<li class="option-item9">
				<input type="radio" name="category" value="전체" id="opt-item9" checked onchange="searchBokjiService(1);">
				<label for="opt-item9" class="option-category-box">
					<i class="icon-opt-all"></i>
					<p>전체</p>
				</label>
			</li>
			<li class="option-item7">
				<input type="radio" name="category" value="지원" id="opt-item7" onchange="searchBokjiService(1);">
				<label for="opt-item7" class="option-category-box">
					<i class="icon-opt-support"></i>
					<p>지원</p>
				</label>
			</li>
			<li class="option-item8">
				<input type="radio" name="category" value="보호" id="opt-item8" onchange="searchBokjiService(1);">
				<label for="opt-item8" class="option-category-box">
					<i class="icon-opt-protect"></i>
					<p>보호</p>
				</label>
			</li>
			<li class="option-item6">
				<input type="radio" name="category" value="상담" id="opt-item6" onchange="searchBokjiService(1);">
				<label for="opt-item6" class="option-category-box">
					<i class="icon-opt-consulting"></i>
					<p>상담</p>
				</label>
			</li>
			<li class="option-item3">
				<input type="radio" name="category" value="보건" id="opt-item3" onchange="searchBokjiService(1);">
				<label for="opt-item3" class="option-category-box">
					<i class="icon-opt-health"></i>
					<p>보건</p>
				</label>
			</li>
			<li class="option-item2">
				<input type="radio" name="category" value="문화" id="opt-item2" onchange="searchBokjiService(1);">
				<label for="opt-item2" class="option-category-box">
					<i class="icon-opt-culture"></i>
					<p>문화</p>
				</label>
			</li>
			<li class="option-item1">
				<input type="radio" name="category" value="주거" id="opt-item1" onchange="searchBokjiService(1);">
				<label for="opt-item1" class="option-category-box">
					<i class="icon-opt-dwelling"></i>
					<p>주거</p>
				</label>
			</li>
			<li class="option-item5">
				<input type="radio" name="category" value="교육" id="opt-item5" onchange="searchBokjiService(1);">
				<label for="opt-item5" class="option-category-box">
					<i class="icon-opt-education"></i>
					<p>교육</p>
				</label>
			</li>
		</ul>
	</nav>

	<!-- 서비스 본문(복지제도) -->
	<div class="welfare-service-list">
		<div class="cont-target">
			
		</div>
		<div class="service-paging">
			<div class="pagination mt-14">
				<div class="paging">
					
				</div>
			</div>
		</div>
	</div>
	<!-- //서비스 본문(복지제도) -->
	
	
	<!-- 복지서비스 상세보기 모달 -->
	<div class="modal fade" id="modal-detail" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <p class="text-title"><img src="/html/core/images/img-brand-logo.svg" alt="eroum"></p>
                    <button data-bs-dismiss="modal">모달 닫기</button>
                </div>
                <div class="modal-body">
                    <div class="modal-detail-title" id="modal-detail-benefitName"></div>
                    <div class="modal-detail-content">
                        <a class="share f_clip" data-bokji-id="">공유하기 <i></i></a>
                        <table>
                            <colgroup>
                                <col class="w-14">
                                <col>
                            </colgroup>
                            <tbody id="modal-detail-table-content">
                                
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>
</div>





<script>
	var cntPerPage = 8;
	var prevModalClass = '';

	//로딩바 생성
	function createProgressLoading() {
		var template = `<div class="progress-loading is-dark">
			<div class="icon">
				<span></span><span></span><span></span>
			</div>
			<p class="text">데이터를 불러오는 중입니다.</p>
		</div>`
		
		$('.cont-target').html(template);		
	}
	

	//복지서비스 조회
	function searchBokjiService(curPage) {
		//로딩바 생성
		createProgressLoading();
		
		//선택된 카테고리
		var categoryText = $('input[name=category]:checked').val();
		
		
		//검색 API 실행
		var params = {
			curPage
			, cntPerPage
			, category:categoryText
		};
		
		$.ajax({
			type: "get",
			url: "/main/search/srvcList.json",
			data: params,
			dataType : 'json'
		})
		.done(function(data) {
			if(data.success) {
				var totalCount = comma(data.listVO.totalCount);
				$('.totalCnt').text(totalCount);
				
				//복지서비스 데이터 그리기
				drawSrchSrvcList(data.listVO.listObject, curPage, data.listVO.totalPage);
			}else{
				alert(data.msg);
			}
			
			//로딩바 제거
			$('.progress-loading').remove();
		})
		.fail(function(data, status, err) {
			alert('서버와 연결이 좋지 않습니다.');
		});
	}
	
	
	//조회된 복지서비스 그리기
	function drawSrchSrvcList(srvcList, curPage, totalPage) {
		var template = '<div class="service-content">';
		
		if (!srvcList || srvcList.length === 0) {
			template += "데이터가 없습니다.";
		} else {
			for(var i = 0; i < srvcList.length; i++) {
				var categoryText = srvcList[i].categoryList.join(' ∙ ');
				var colorCode = getColorCode(categoryText);
				
				template += `<a class="content-item is-color` + colorCode + `" onclick="viewSrvcDetail(` + srvcList[i].bokjiId + `)">
					<div class="content">
						<img src="/html/page/index/assets/images/img-sample.png" class="content-img" alt="img-sample"/>
						<div class="content-inner">
							<div class="content-inner-text">
								<span class="badge-city">` + '경기도 고양시청' + `</span>     
								<p class="name">` + srvcList[i].benefitName + `</p>
								<p class="type">
									<span>` + srvcList[i].bokjiResource + `</span>
									<span>
										` + categoryText + `
									</span>
								</p>
							</div>
							<div class="flex items-center justify-between">
								<span class="btn-detail">자세히보기</span>
								<i class="part"></i>
							</div>
						</div>
					</div>
				</a>`;
			}
			
			//페이지네이션
			setPagenation(curPage, totalPage);
		}
		
		template += '</div>'
		$('.cont-target').html(template);
	}
	
	//페이지네이션 처리
	function setPagenation(curPage, totalPage) {
		var prePage = 1;
		var nextPage = totalPage;
		if (curPage - 1 > 1) {
			prePage = curPage - 1;
		}
		if (curPage + 1 < totalPage) {
			nextPage = curPage + 1;
		}
		
		var template = `<a class="prev" onclick="searchBokjiService(` + prePage + `)">이전</a>`;
		
		if (curPage <= 4) {
			var maxPage = totalPage > 7 ? 7 : totalPage;
			for (var i = 1; i <= maxPage; i++) {
				template += `<a class="page` + (i === curPage ? ` active` : ``) + `" onclick="searchBokjiService(` + i + `)">` + i + `</a>`;	
			}
		} else if (curPage + 3 >= totalPage) {
			var minPage = (totalPage - 6) < 1 ? 1 : (totalPage - 6);
			for (var i = minPage; i <= totalPage; i++) {
				template += `<a class="page` + (i === curPage ? ` active` : ``) + `" onclick="searchBokjiService(` + i + `)">` + i + `</a>`;	
			}
		} else {
			for (var i = curPage - 3; i <= curPage + 3; i++) {
				template += `<a class="page` + (i === curPage ? ` active` : ``) + `" onclick="searchBokjiService(` + i + `)">` + i + `</a>`;
			}
		}
		
		template += `<a class="next" onclick="searchBokjiService(` + nextPage + `)">다음</a>`;
		
		$('.paging').html(template);
	}
	
	
	//복지서비스 상세보기 모달 띄우기
	function viewSrvcDetail(bokjiId) {
		//이전에 color class를 넣었다면 제거
		if (prevModalClass) {
			$('#modal-detail').removeClass(prevModalClass);
		}
		
		$.ajax({
			type: "get",
			url: "/main/srvc/detail.json",
			data: {bokjiId},
			dataType : 'json'
		})
		.done(function(data) {
			if(data.success) {
				var srvcInfo = data.bokjiVO;
				var categoryText = srvcInfo.categoryList.join(' ∙ ');
				var colorCode = getColorCode(categoryText);
				
				//modal에 color class 추가
				prevModalClass = 'is-color' + colorCode;
				$('#modal-detail').addClass(prevModalClass);
				
				
				//모달에 데이터 매핑
				var contentsTemplate = '';
				
				$('#modal-detail-benefitName').html(srvcInfo.benefitName);
				
				//분류 매핑
				if (srvcInfo.categoryList && srvcInfo.categoryList.length > 0) {
					var categoryTemplate = '';
					for(var i = 0; i < srvcInfo.categoryList.length; i++) {
						categoryTemplate += `<span class="label">` + srvcInfo.categoryList[i] + `</span>`;
					}
					
					contentsTemplate += `
						<tr>
	                    	<th scope="row">분류</th>
	                    	<td id="modal-detail-category">` + categoryTemplate + `</td>
	                    </tr>
					`;
				}
				
				//지원조건 매핑
				if (srvcInfo.entitledCondition) {
					contentsTemplate += `
							<tr>
                            	<th scope="row">지원조건</th>
                            	<td id="modal-detail-entitledCondition">` + srvcInfo.entitledCondition + `</td>
                            </tr>
                    `;
				}
				
				//지원방법 매핑
				if (srvcInfo.applyMethod) {
					contentsTemplate += `
						<tr>
	                        <th scope="row">지원방법</th>
	                        <td id="modal-detail-applyMethod">` + srvcInfo.applyMethod + `</td>
	                    </tr>
					`;
				}
				
				//지원기간 매핑
				if (srvcInfo.beginDate && srvcInfo.endDate) {
					var dateTemplate = '';
					if (srvcInfo.dueDate) {
						dateTemplate += srvcInfo.dueDate + '<br>';
					}
					dateTemplate += srvcInfo.beginDate + ' ~ ' + srvcInfo.endDate;
					
					contentsTemplate += `
						<tr>
	                        <th scope="row">지원기간</th>
	                        <td id="modal-detail-date">` + dateTemplate + `</td>
	                    </tr>
					`;
				}
				
				//필요서류 매핑
				if (srvcInfo.requiredDocuments) {
					contentsTemplate += `
						<tr>
	                        <th scope="row">필요서류</th>
	                        <td id="modal-detail-requiredDocuments">` + srvcInfo.requiredDocuments + `</td>
	                    </tr>
					`;
				}
				
				//지원금 매핑
				if (srvcInfo.totalSupportAmount) {
					contentsTemplate += `
						<tr>
	                        <th scope="row">지원금</th>
	                        <td id="modal-detail-totalSupportAmount">` + srvcInfo.totalSupportAmount + `</td>
	                    </tr>
					`;
				}
				
				//내용 매핑
				if (srvcInfo.supportContent) {
					contentsTemplate += `
						<tr>
	                        <th scope="row">내용</th>
	                        <td>
	                            <div class="content" id="modal-detail-supportContent">` + srvcInfo.supportContent + `</div>
	                        </td>
	                    </tr>
					`;
				}
				
				//출처 매핑
				if (srvcInfo.bokjiResource) {
					var bokjiResourceTemplate = '';
					if (srvcInfo.refUrl) {
						bokjiResourceTemplate = `<a href="` + srvcInfo.refUrl + `" target="_blank" class="home">` + srvcInfo.bokjiResource + `</a>`;
					} else {
						bokjiResourceTemplate = srvcInfo.bokjiResource;
					}
					
					contentsTemplate += `
						<tr>
	                        <th scope="row">출처</th>
	                        <td id="modal-detail-bokjiResource">` + bokjiResourceTemplate + `</td>
	                    </tr>
					`;
				}
				
				//기관명 매핑
				if (srvcInfo.provider) {
					contentsTemplate += `
						<tr>
	                        <th scope="row">기관명</th>
	                        <td id="modal-detail-institutionName">` + srvcInfo.provider.institutionName + `</td>
	                    </tr>
					`;
				}
				
				//모달 푸터 매핑
				var footerTemplate = '';
				if (srvcInfo.refUrl) {
					footerTemplate += `<a href="` + srvcInfo.refUrl + `" target="_blank" class="btn btn-request">자세한 신청방법 보기</a>`;
				}
				footerTemplate += `<a href="#" class="btn btn-share sm:hidden f_clip" data-bokji-id="` + srvcInfo.bokjiId + `">공유하기</a>`;
				$('.modal-footer').html(footerTemplate);
				
				//모달 컨텐츠 추가
				$('#modal-detail-table-content').html(contentsTemplate);
				
				//모달 띄우기
				$('#modal-detail').modal('show');
				
				//공유하기 복지ID 매핑
				$('.f_clip').prop('data-bokji-id', srvcInfo.bokjiId);
			}else{
				alert(data.msg);
			}
		})
		.fail(function(data, status, err) {
			alert('서버와 연결이 좋지 않습니다.');
		});
	}
	
	
	// 콤마 찍기 : ###,###
	function comma(num){
	    var len, point, str;
	    str = "0";
		if(num != ''){
		    num = num + "";
		    point = num.length % 3 ;
		    len = num.length;

		    str = num.substring(0, point);
		    while (point < len) {
		        if (str != "") str += ",";
		        str += num.substring(point, point + 3);
		        point += 3;
		    }
	    }
	    return str;
	}
	
	//color 코드 반환
	function getColorCode(categoryText) {
		var colorCode = '';
		if (categoryText.includes('주거')) {
			colorCode = '1';
		} else if (categoryText.includes('문화')) {
			colorCode = '2';
		} else if (categoryText.includes('보건')) {
			colorCode = '3';
		} else if (categoryText.includes('고용')) {
			colorCode = '4';
		} else if (categoryText.includes('교육')) {
			colorCode = '5';
		} else if (categoryText.includes('상담')) {
			colorCode = '6';
		} else if (categoryText.includes('보호')) {
			colorCode = '8';
		} else if (categoryText.includes('지원')) {
			colorCode = '7';
		}
		return colorCode;
	}
	
	
	$(function () {
		searchBokjiService(1);
		
		//공유하기 기능
		$(document).on("click", ".f_clip", function(e){
			e.preventDefault();
			let bokjiId = $(this).data("bokjiId");
			let nowUrl = window.location.href.split("#")[0]+ "#" + bokjiId;
			const shareObject = {
				title: $(this).parents(".modal").find(".modal-project-title").text()
				, text: '이로움ON'
				, url: nowUrl
			};

			//console.log(navigator.userAgent.indexOf("Mozilla"));
			if (navigator.share) { // Navigator를 지원하는 경우만 실행
				navigator.share(shareObject).then(() => {
					// 정상 동작할 경우 실행
				}).catch((error) => {
					//alert('에러가 발생했습니다.')
				})
			} else { // navigator를 지원하지 않는 경우
			  	//alert('페이지 공유를 지원하지 않습니다.')

			  	// 사파리 구분
			  	const agent = navigator.userAgent.toLowerCase();
				if(agent.indexOf("safari") > -1){
					shareDialog.classList.add('is-open');
				}else{
					navigator.clipboard.writeText(nowUrl).then(res=>{
						alert("주소가 복사되었습니다!");
					});
				}
			}
		});
	});
</script>